{"version":3,"sources":["../../src/internal/RenderToLayer.js"],"names":["RenderToLayer","onClickAway","event","defaultPrevented","props","componentClickAway","open","el","layer","target","window","document","documentElement","contains","isDescendant","componentDidMount","renderLayer","componentDidUpdate","componentWillUnmount","unrenderLayer","getLayer","useLayerForClickAway","style","position","removeEventListener","body","removeChild","render","createElement","appendChild","addEventListener","top","bottom","left","right","zIndex","context","muiTheme","setTimeout","layerElement","propTypes","func","bool","isRequired","defaultProps","contextTypes","object"],"mappings":"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","file":"RenderToLayer.js","sourcesContent":["import {Component} from 'react';\nimport PropTypes from 'prop-types';\nimport {unstable_renderSubtreeIntoContainer, unmountComponentAtNode} from 'react-dom';\n\nimport Dom from '../utils/dom';\n\n// heavily inspired by https://github.com/Khan/react-components/blob/master/js/layered-component-mixin.jsx\nclass RenderToLayer extends Component {\n  static propTypes = {\n    componentClickAway: PropTypes.func,\n    open: PropTypes.bool.isRequired,\n    render: PropTypes.func.isRequired,\n    useLayerForClickAway: PropTypes.bool,\n  };\n\n  static defaultProps = {\n    useLayerForClickAway: true,\n  };\n\n  static contextTypes = {\n    muiTheme: PropTypes.object.isRequired,\n  };\n\n  componentDidMount() {\n    this.renderLayer();\n  }\n\n  componentDidUpdate() {\n    this.renderLayer();\n  }\n\n  componentWillUnmount() {\n    this.unrenderLayer();\n  }\n\n  onClickAway = (event) => {\n    if (event.defaultPrevented) {\n      return;\n    }\n\n    if (!this.props.componentClickAway) {\n      return;\n    }\n\n    if (!this.props.open) {\n      return;\n    }\n\n    const el = this.layer;\n    if (event.target !== el && event.target === window ||\n      (document.documentElement.contains(event.target) && !Dom.isDescendant(el, event.target))) {\n      this.props.componentClickAway(event);\n    }\n  };\n\n  getLayer() {\n    return this.layer;\n  }\n\n  unrenderLayer() {\n    if (!this.layer) {\n      return;\n    }\n\n    if (this.props.useLayerForClickAway) {\n      this.layer.style.position = 'relative';\n      this.layer.removeEventListener('touchstart', this.onClickAway);\n      this.layer.removeEventListener('click', this.onClickAway);\n    } else {\n      window.removeEventListener('touchstart', this.onClickAway);\n      window.removeEventListener('click', this.onClickAway);\n    }\n\n    unmountComponentAtNode(this.layer);\n    document.body.removeChild(this.layer);\n    this.layer = null;\n  }\n\n  /**\n   * By calling this method in componentDidMount() and\n   * componentDidUpdate(), you're effectively creating a \"wormhole\" that\n   * funnels React's hierarchical updates through to a DOM node on an\n   * entirely different part of the page.\n   */\n  renderLayer() {\n    const {\n      open,\n      render,\n    } = this.props;\n\n    if (open) {\n      if (!this.layer) {\n        this.layer = document.createElement('div');\n        document.body.appendChild(this.layer);\n\n        if (this.props.useLayerForClickAway) {\n          this.layer.addEventListener('touchstart', this.onClickAway);\n          this.layer.addEventListener('click', this.onClickAway);\n          this.layer.style.position = 'fixed';\n          this.layer.style.top = 0;\n          this.layer.style.bottom = 0;\n          this.layer.style.left = 0;\n          this.layer.style.right = 0;\n          this.layer.style.zIndex = this.context.muiTheme.zIndex.layer;\n        } else {\n          setTimeout(() => {\n            window.addEventListener('touchstart', this.onClickAway);\n            window.addEventListener('click', this.onClickAway);\n          }, 0);\n        }\n      }\n\n      const layerElement = render();\n      this.layerElement = unstable_renderSubtreeIntoContainer(this, layerElement, this.layer);\n    } else {\n      this.unrenderLayer();\n    }\n  }\n\n  render() {\n    return null;\n  }\n}\n\nexport default RenderToLayer;\n"]}